<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.webFramework.mappers.lectureMapper">
    <!--  분류별 목록  -->
    <select id="listLecture" resultType="com.webFramework.domain.LectureVO" parameterType="hashmap">
        <![CDATA[
        select *
          from lecture_info
          where lectureNo > 0 and lectureState = 1
        ]]>
        <if test="courseNo != 0">
             and lectureNo in (select lectureNo
                                from lecture_hierarchy
                                where hierarchyNo in (select hierarchyNo
                                                       from hierarchy_table
                                                       where courseNo = #{courseNo}
                                                       <if test="categoryNo != 0">
                                                         and categoryNo = ${categoryNo}
                                                       </if>
                                                       <if test="skillNo != 0">
                                                         and skillNo = ${skillNo}
                                                       </if>
                                                       ))
        </if>
           order by lectureNo desc, lectureOpenDate desc
    </select>

    <select id="listCourse" resultType="map">
        select c.courseNo, courseName
          from hierarchy_table as h
        left join course_table as c
          on h.courseNo = c.courseNo
          group by courseNo
    </select>

    <select id="listCategory" resultType="map">
        select c.courseNo, courseName, a.categoryNo, categoryName
          from hierarchy_table as h
        left join course_table as c
          on h.courseNo = c.courseNo
        left join category_table as a
          on h.categoryNo = a.categoryNo
        group by courseNo, categoryNo
    </select>
</mapper>